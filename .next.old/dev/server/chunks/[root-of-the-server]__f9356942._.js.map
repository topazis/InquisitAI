{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/steve/inquisitai/app/api/investigate/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport OpenAI from \"openai\";\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\nconst client = new OpenAI({\r\n  apiKey: process.env.OPENAI_API_KEY,\r\n});\r\n\r\ntype ScreenshotPayload = {\r\n  name: string;\r\n  type: string;\r\n  size: number;\r\n  dataUrl: string; // \"data:image/png;base64,...\"\r\n};\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const { prompt, presetId, screenshot } = (await req.json()) as {\r\n      prompt: string;\r\n      presetId?: string;\r\n      screenshot?: ScreenshotPayload | null;\r\n    };\r\n\r\n    const safePrompt = String(prompt ?? \"\").trim();\r\n    if (!safePrompt) {\r\n      return NextResponse.json({ error: \"Missing prompt\" }, { status: 400 });\r\n    }\r\n\r\n    const hasScreenshot =\r\n      screenshot &&\r\n      typeof screenshot.dataUrl === \"string\" &&\r\n      screenshot.dataUrl.startsWith(\"data:image/\");\r\n\r\n    const system = `\r\nYou are InquistAI: a careful, practical investigation assistant for screenshots, messages, and claims.\r\nOutput must be structured and actionable. Avoid hallucinating; if something is unclear in the screenshot, say so.\r\n`;\r\n\r\n    const userText = `\r\nTASK:\r\n1) Extract what the screenshot says (verbatim where possible).\r\n2) Identify scam / manipulation / urgency / impersonation patterns.\r\n3) List specific verification steps the user should take (safe response plan).\r\n4) Give a verdict: Low / Medium / High risk with a confidence 0â€“1.\r\n5) Provide a short \"What to do next in 60 seconds\" checklist.\r\n\r\nCONTEXT:\r\npresetId=${presetId ?? \"unknown\"}\r\n\r\nUser prompt:\r\n${safePrompt}\r\n`;\r\n\r\n    // If no screenshot, behave like your current text-only flow.\r\n    // If screenshot exists, include it as an image input.\r\n    const response = await client.chat.completions.create({\r\n      model: \"gpt-4o-mini\", // swap to your preferred vision-capable model\r\n      messages: [\r\n        { role: \"system\", content: system },\r\n        {\r\n          role: \"user\",\r\n          content: hasScreenshot\r\n            ? [\r\n                { type: \"text\", text: userText },\r\n                { type: \"image_url\", image_url: { url: screenshot!.dataUrl } },\r\n              ]\r\n            : [{ type: \"text\", text: userText }],\r\n        },\r\n      ],\r\n      temperature: 0.2,\r\n    });\r\n\r\n    const result =\r\n      response.choices?.[0]?.message?.content?.trim() ||\r\n      \"No result returned. Try again.\";\r\n\r\n    return NextResponse.json({ result });\r\n  } catch (err: any) {\r\n    return NextResponse.json(\r\n      { error: \"Server error\", detail: String(err?.message ?? err) },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;AAEO,MAAM,UAAU;AAEvB,MAAM,SAAS,IAAI,mLAAM,CAAC;IACxB,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC;AASO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,GAAI,MAAM,IAAI,IAAI;QAMxD,MAAM,aAAa,OAAO,UAAU,IAAI,IAAI;QAC5C,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,gBACJ,cACA,OAAO,WAAW,OAAO,KAAK,YAC9B,WAAW,OAAO,CAAC,UAAU,CAAC;QAEhC,MAAM,SAAS,CAAC;;;AAGpB,CAAC;QAEG,MAAM,WAAW,CAAC;;;;;;;;;SASb,EAAE,YAAY,UAAU;;;AAGjC,EAAE,WAAW;AACb,CAAC;QAEG,6DAA6D;QAC7D,sDAAsD;QACtD,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpD,OAAO;YACP,UAAU;gBACR;oBAAE,MAAM;oBAAU,SAAS;gBAAO;gBAClC;oBACE,MAAM;oBACN,SAAS,gBACL;wBACE;4BAAE,MAAM;4BAAQ,MAAM;wBAAS;wBAC/B;4BAAE,MAAM;4BAAa,WAAW;gCAAE,KAAK,WAAY,OAAO;4BAAC;wBAAE;qBAC9D,GACD;wBAAC;4BAAE,MAAM;4BAAQ,MAAM;wBAAS;qBAAE;gBACxC;aACD;YACD,aAAa;QACf;QAEA,MAAM,SACJ,SAAS,OAAO,EAAE,CAAC,EAAE,EAAE,SAAS,SAAS,UACzC;QAEF,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAO;IACpC,EAAE,OAAO,KAAU;QACjB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAgB,QAAQ,OAAO,KAAK,WAAW;QAAK,GAC7D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}